CREATE DATABASE wk_wikicode DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

DROP TABLE IF EXISTS wk_lookup;
CREATE TABLE wk_lookup (
	id TINYINT(3) UNSIGNED NOT NULL,
	name VARCHAR(30) NOT NULL,
    PRIMARY KEY (`id`),
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

DROP TABLE IF EXISTS wk_user;
CREATE TABLE wk_user (
    uid INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
    login VARCHAR(30) NOT NULL,
    password VARCHAR(32) NOT NULL,
    salt VARCHAR(32) NOT NULL,
    email VARCHAR(50) NOT NULL,
    user_type TINYINT(1) NOT NULL DEFAULT '0' COMMENT '0 is user and 1 is moderator',
    up_time DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
    PRIMARY KEY (`uid`),
    UNIQUE (`login`,`email`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

DROP TABLE IF EXISTS wk_profile;
CREATE TABLE wk_profile (
    id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
    user_id INT(11) UNSIGNED NOT NULL,
    name VARCHAR(50) NOT NULL DEFAULT '',
    url VARCHAR(128) NOT NULL DEFAULT '',    
    PRIMARY KEY (`id`),
    CONSTRAINT FK_profile_user FOREIGN KEY (user_id)
		REFERENCES wk_user (uid) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

DROP TABLE IF EXISTS wk_content;
CREATE TABLE wk_content (
	id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
	title VARCHAR(128) NOT NULL,
	content TEXT NOT NULL,
	tags TEXT,
	status TINYINT(1) NOT NULL DEFAULT '0' COMMENT '0 is user and 1 is moderator',
	create_time DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
	update_time DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
	author_id INT(11) UNSIGNED NOT NULL,
    PRIMARY KEY (`id`),
	CONSTRAINT FK_content_author FOREIGN KEY (author_id)
		REFERENCES wk_user (uid) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;

DROP TABLE IF EXISTS wk_comment;
CREATE TABLE wk_comment (
	id INT(11) UNSIGNED NOT NULL AUTO_INCREMENT,
	content TEXT NOT NULL,
	status TINYINT(1) NOT NULL DEFAULT '0',
	create_time DATETIME NOT NULL DEFAULT '0000-00-00 00:00:00',
	author_id INT(11) UNSIGNED NOT NULL,
	email VARCHAR(128) NOT NULL,
	url VARCHAR(128),
	content_id INT(11) UNSIGNED NOT NULL,
	CONSTRAINT FK_comment_content FOREIGN KEY (content_id)
		REFERENCES wk_content (id) ON DELETE CASCADE ON UPDATE RESTRICT
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci;